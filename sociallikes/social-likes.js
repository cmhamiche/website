!function(t){"function"==typeof define&&define.amd?define(["jquery"],t):t(jQuery)}(function(r,t){function n(t,e){this.container=t,this.options=e,this.init()}function i(t,e){this.widget=t,this.options=r.extend({},e),this.detectService(),this.service&&this.init()}function c(t,e){return l(t,e,encodeURIComponent)}function l(t,i,n){return t.replace(/\{([^\}]+)\}/g,function(t,e){return e in i?n?n(i[e]):i[e]:t})}function a(t,e){t="social-likes__"+t;return t+" "+t+"_"+e}function u(i,n){var s=r(document),o="click touchstart keydown";s.on(o,function t(e){"keydown"===e.type&&27!==e.which||r(e.target).closest(i).length||(i.removeClass("social-likes_opened"),s.off(o,t),r.isFunction(n)&&n())})}var e="https:"===location.protocol?"https:":"http:",s="https:"==e,p={facebook:{counterUrl:"https://graph.facebook.com/fql?q=SELECT+total_count+FROM+link_stat+WHERE+url%3D%22{url}%22&callback=?",convertNumber:function(t){return t.data[0].total_count},popupUrl:"https://www.facebook.com/sharer/sharer.php?u={url}",popupWidth:600,popupHeight:500},twitter:{counterUrl:"https://cdn.api.twitter.com/1/urls/count.json?url={url}&callback=?",convertNumber:function(t){return t.count},popupUrl:"https://twitter.com/intent/tweet?url={url}&text={title}",popupWidth:600,popupHeight:450,click:function(){return/[\.\?:\-\u2013\u2014]\s*$/.test(this.options.title)||(this.options.title+=":"),!0}},mailru:{counterUrl:e+"//connect.mail.ru/share_count?url_list={url}&callback=1&func=?",convertNumber:function(t){for(var e in t)if(t.hasOwnProperty(e))return t[e].shares},popupUrl:e+"//connect.mail.ru/share?share_url={url}&title={title}",popupWidth:550,popupHeight:360},vkontakte:{counterUrl:"https://vk.com/share.php?act=count&url={url}&index={index}",counter:function(t,e){var i=p.vkontakte;i._||(i._=[],window.VK||(window.VK={}),window.VK.Share={count:function(t,e){i._[t].resolve(e)}});var n=i._.length;i._.push(e),r.getScript(c(t,{index:n})).fail(e.reject)},popupUrl:e+"//vk.com/share.php?url={url}&title={title}",popupWidth:550,popupHeight:330},odnoklassniki:{counterUrl:s?t:"http://connect.ok.ru/dk?st.cmd=extLike&ref={url}&uid={index}",counter:function(t,e){var i=p.odnoklassniki;i._||(i._=[],window.ODKL||(window.ODKL={}),window.ODKL.updateCount=function(t,e){i._[t].resolve(e)});var n=i._.length;i._.push(e),r.getScript(c(t,{index:n})).fail(e.reject)},popupUrl:"http://connect.ok.ru/dk?st.cmd=WidgetSharePreview&service=odnoklassniki&st.shareUrl={url}",popupWidth:550,popupHeight:360},plusone:{counterUrl:s?t:"http://share.yandex.ru/gpp.xml?url={url}",counter:function(t,e){var i=p.plusone;i._?e.reject():(window.services||(window.services={}),window.services.gplus={cb:function(t){"string"==typeof t&&(t=t.replace(/\D/g,"")),i._.resolve(parseInt(t,10))}},i._=e,r.getScript(c(t)).fail(e.reject))},popupUrl:"https://plus.google.com/share?url={url}",popupWidth:700,popupHeight:500},pinterest:{counterUrl:e+"//api.pinterest.com/v1/urls/count.json?url={url}&callback=?",convertNumber:function(t){return t.count},popupUrl:e+"//pinterest.com/pin/create/button/?url={url}&description={title}",popupWidth:630,popupHeight:270}},h={promises:{},fetch:function(t,e,i){h.promises[t]||(h.promises[t]={});var n,s,o=h.promises[t];return!i.forceUpdate&&o[e]||(n=r.extend({},p[t],i),s=r.Deferred(),(t=n.counterUrl&&c(n.counterUrl,{url:e}))&&r.isFunction(n.counter)?n.counter(t,s):n.counterUrl?r.getJSON(t).done(function(t){try{var e=t;r.isFunction(n.convertNumber)&&(e=n.convertNumber(t)),s.resolve(e)}catch(t){s.reject()}}).fail(s.reject):s.reject(),o[e]=s.promise()),o[e]}};r.fn.socialLikes=function(i){return this.each(function(){var t=r(this),e=t.data("social-likes");e?r.isPlainObject(i)&&e.update(i):(e=new n(t,r.extend({},r.fn.socialLikes.defaults,i,function(t){function e(t,e){return e.toUpper()}var i,n={};for(i in t=t.data()){var s=t[i];"yes"===s?s=!0:"no"===s&&(s=!1),n[i.replace(/-(\w)/g,e)]=s}return n}(t))),t.data("social-likes",e))})},r.fn.socialLikes.defaults={url:window.location.href.replace(window.location.hash,""),title:document.title,counters:!0,zeroes:!1,wait:500,timeout:1e4,popupCheckInterval:500,singleTitle:"Share",initHtml:!0},n.prototype={init:function(){this.container.addClass("social-likes"),this.single=this.container.hasClass("social-likes_single"),this.initUserButtons(),this.number=this.countersLeft=0,this.container.on("counter.social-likes",r.proxy(this.updateCounter,this));var t=this.container.children();this.makeSingleButton(),this.buttons=[],t.each(r.proxy(function(t,e){e=new i(r(e),this.options);this.buttons.push(e),e.options.counterUrl&&this.countersLeft++},this)),this.options.counters?(this.timer=setTimeout(r.proxy(this.appear,this),this.options.wait),this.timeout=setTimeout(r.proxy(this.ready,this,!0),this.options.timeout)):this.appear()},initUserButtons:function(){!this.userButtonInited&&window.socialLikesButtons&&r.extend(!0,p,socialLikesButtons),this.userButtonInited=!0},makeSingleButton:function(){var s,t,o,e;this.single&&((s=this.container).addClass("social-likes_vertical"),s.wrap(r("<div>",{class:"social-likes_single-w"})),s.wrapInner(r("<div>",{class:"social-likes__single-container"})),t=s.parent(),o=r("<div>",{class:a("widget","single")}),e=r(l('<div class="{buttonCls}"><span class="{iconCls}"></span>{title}</div>',{buttonCls:a("button","single"),iconCls:a("icon","single"),title:this.options.singleTitle})),o.append(e),t.append(o),o.on("click",function(){var t,e,i,n;return o.toggleClass("social-likes__widget_active"),o.hasClass("social-likes__widget_active")?(s.css({left:-(s.width()-o.width())/2,top:-s.height()}),t=s,document.documentElement.getBoundingClientRect&&(e=parseInt(t.css("left"),10),i=parseInt(t.css("top"),10),(n=t[0].getBoundingClientRect()).left<10?t.css("left",10-n.left+e):n.right>window.innerWidth-10&&t.css("left",window.innerWidth-n.right-10+e),n.top<10?t.css("top",10-n.top+i):n.bottom>window.innerHeight-10&&t.css("top",window.innerHeight-n.bottom-10+i)),t.addClass("social-likes_opened"),u(s,function(){o.removeClass("social-likes__widget_active")})):s.removeClass("social-likes_opened"),!1}),this.widget=o)},update:function(t){if(t.forceUpdate||t.url!==this.options.url){this.number=0,this.countersLeft=this.buttons.length,this.widget&&this.widget.find(".social-likes__counter").remove(),r.extend(this.options,t);for(var e=0;e<this.buttons.length;e++)this.buttons[e].update(t)}},updateCounter:function(t,e,i){i&&(this.number+=i,this.single&&this.getCounterElem().text(this.number)),this.countersLeft--,0===this.countersLeft&&(this.appear(),this.ready())},appear:function(){this.container.addClass("social-likes_visible")},ready:function(t){this.timeout&&clearTimeout(this.timeout),this.container.addClass("social-likes_ready"),t||this.container.trigger("ready.social-likes",this.number)},getCounterElem:function(){var t=this.widget.find(".social-likes__counter_single");return t.length||(t=r("<span>",{class:a("counter","single")}),this.widget.append(t)),t}},i.prototype={init:function(){this.detectParams(),this.options.initHtml?this.initHtml():this.widget.on("click",r.proxy(this.click,this)),setTimeout(r.proxy(this.initCounter,this),0)},update:function(t){r.extend(this.options,{forceUpdate:!1},t),this.widget.find(".social-likes__counter").remove(),this.initCounter()},detectService:function(){var t=this.widget.data("service");if(!t){for(var e=(e=this.widget[0]).classList||e.className.split(" "),i=0;i<e.length;i++){var n=e[i];if(p[n]){t=n;break}}if(!t)return}this.service=t,r.extend(this.options,p[t])},detectParams:function(){var t,e=this.widget.data();e.counter&&(t=parseInt(e.counter,10),isNaN(t)?this.options.counterUrl=e.counter:this.options.counterNumber=t),e.title&&(this.options.title=e.title),e.url&&(this.options.url=e.url)},initHtml:function(){var t=this.options,e=this.widget,i=e.find("a");i.length&&this.cloneDataAttrs(i,e),i=r("<span>",{class:this.getElementClassNames("button"),text:e.text()}),t.clickUrl?(t=c(t.clickUrl,{url:t.url,title:t.title}),t=r("<a>",{href:t}),this.cloneDataAttrs(e,t),e.replaceWith(t),this.widget=e=t):e.on("click",r.proxy(this.click,this)),e.removeClass(this.service),e.addClass(this.getElementClassNames("widget")),i.prepend(r("<span>",{class:this.getElementClassNames("icon")})),e.empty().append(i),this.button=i},initCounter:function(){this.options.counters&&(this.options.counterNumber?this.updateCounter(this.options.counterNumber):h.fetch(this.service,this.options.url,{counterUrl:this.options.counterUrl,forceUpdate:this.options.forceUpdate}).always(r.proxy(this.updateCounter,this)))},cloneDataAttrs:function(t,e){var i,n=t.data();for(i in n)n.hasOwnProperty(i)&&e.data(i,n[i])},getElementClassNames:function(t){return a(t,this.service)},updateCounter:function(t){t=parseInt(t,10)||0;var e={class:this.getElementClassNames("counter"),text:t};t||this.options.zeroes||(e.class+=" social-likes__counter_empty",e.text=""),e=r("<span>",e),this.widget.append(e),this.widget.trigger("counter.social-likes",[this.service,t])},click:function(t){var e=this.options,i=!0;return r.isFunction(e.click)&&(i=e.click.call(this,t)),i&&(t=c(e.popupUrl,{url:e.url,title:e.title}),t=this.addAdditionalParamsToUrl(t),this.openPopup(t,{width:e.popupWidth,height:e.popupHeight})),!1},addAdditionalParamsToUrl:function(t){var e=r.param(r.extend(this.widget.data(),this.options.data));if(r.isEmptyObject(e))return t;var i=-1===t.indexOf("?")?"?":"&";return t+i+e},openPopup:function(t,e){var i=Math.round(screen.width/2-e.width/2),n=0;screen.height>e.height&&(n=Math.round(screen.height/3-e.height/2));var s,o=window.open(t,"sl_"+this.service,"left="+i+",top="+n+",width="+e.width+",height="+e.height+",personalbar=0,toolbar=0,scrollbars=1,resizable=1");o?(o.focus(),this.widget.trigger("popup_opened.social-likes",[this.service,o]),s=setInterval(r.proxy(function(){o.closed&&(clearInterval(s),this.widget.trigger("popup_closed.social-likes",this.service))},this),this.options.popupCheckInterval)):location.href=t}},r(function(){r(".social-likes").socialLikes()})});